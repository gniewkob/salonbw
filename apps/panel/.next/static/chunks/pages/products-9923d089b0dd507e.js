(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[345],{3981:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/products",function(){return r(4749)}])},3464:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var n=r(1549),s=r(4194);function a(e){let{data:t,columns:r,initialSort:a,renderActions:c,pageSize:o=10}=e,[d,i]=(0,s.useState)(""),[l,u]=(0,s.useState)(a),[p,h]=(0,s.useState)("asc"),[f,m]=(0,s.useState)(0),x=t.filter(e=>r.some(t=>String(e[t.accessor]).toLowerCase().includes(d.toLowerCase()))),g=l?[...x].sort((e,t)=>{let r=e[l],n=t[l];return r===n?0:"asc"===p?r>n?1:-1:r<n?1:-1}):x,b=g.slice(f*o,(f+1)*o),y=Math.ceil(g.length/o),j=e=>{l===e?h("asc"===p?"desc":"asc"):(u(e),h("asc"))};return(0,n.jsxs)("div",{children:[(0,n.jsx)("input",{placeholder:"Search",value:d,onChange:e=>i(e.target.value),className:"border p-1 mb-2"}),(0,n.jsxs)("table",{className:"min-w-full border",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"bg-gray-50",children:[r.map(e=>(0,n.jsxs)("th",{className:"p-2 text-left cursor-pointer",onClick:()=>j(e.accessor),children:[e.header,l===e.accessor&&("asc"===p?" ▲":" ▼")]},String(e.accessor))),(0,n.jsx)("th",{className:"p-2"})]})}),(0,n.jsx)("tbody",{children:b.map((e,t)=>(0,n.jsxs)("tr",{className:"border-t",children:[r.map(t=>(0,n.jsx)("td",{className:"p-2",children:String(e[t.accessor])},String(t.accessor))),(0,n.jsx)("td",{className:"p-2",children:c?c(e):null})]},t))})]}),(0,n.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,n.jsx)("button",{disabled:0===f,onClick:()=>m(e=>Math.max(e-1,0)),className:"border px-2 py-1",children:"Prev"}),(0,n.jsxs)("span",{children:[f+1," / ",y||1]}),(0,n.jsx)("button",{disabled:f+1>=y,onClick:()=>m(e=>Math.min(e+1,y-1)),className:"border px-2 py-1",children:"Next"})]})]})}},2592:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var n=r(1549),s=r(4194);function a(e){let{open:t,onClose:r,children:a}=e;return((0,s.useEffect)(()=>{if("undefined"==typeof document)return;let e=e=>{"Escape"===e.key&&r()};return t&&document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t,r]),t)?(0,n.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center",children:(0,n.jsx)("div",{role:"dialog",className:"bg-white p-4 rounded shadow min-w-[300px]",children:a})}):null}},6982:function(e,t,r){"use strict";r.d(t,{s:function(){return c}});var n=r(70),s=r(1247);let a=e=>["api",e];function c(e){var t,r;let{apiFetch:c}=(0,s.a)(),o=(0,n.a)({queryKey:a(e),queryFn:()=>c(e)});return{data:null!==(t=o.data)&&void 0!==t?t:null,error:null!==(r=o.error)&&void 0!==r?r:null,loading:o.isLoading,refetch:o.refetch,queryKey:a(e)}}},4749:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return b}});var n=r(1549),s=r(4194),a=r(7666),c=r.n(a),o=r(8583),d=r(1554),i=r(3464),l=r(2592),u=r(6982),p=r(1247),h=r(2806),f=r(3656);let m=function(){let e=function(){{var e;let t=!!window.Cypress,r=null===(e=window)||void 0===e?void 0:e.NEXT_PUBLIC_TEST_LOG;return t||"true"===r||"true"===f.env.NEXT_PUBLIC_TEST_LOG}}(),t=t=>function(){for(var r=arguments.length,n=Array(r),s=0;s<r;s++)n[s]=arguments[s];e&&t("[test]",...n)};return{enabled:e,debug:t(console.debug.bind(console)),info:t(console.info.bind(console)),warn:t(console.warn.bind(console)),error:t(console.error.bind(console))}}(),x=c()(()=>r.e(570).then(r.bind(r,6570)),{loadableGenerated:{webpack:()=>[6570]},ssr:!1,loading:()=>(0,n.jsx)("div",{className:"p-4 text-sm text-gray-500",children:"Loading product form…"})}),g=c()(()=>r.e(753).then(r.bind(r,1753)),{loadableGenerated:{webpack:()=>[1753]},ssr:!1,loading:()=>(0,n.jsx)("div",{className:"p-4 text-sm text-gray-500",children:"Loading stock form…"})});function b(){let{data:e}=(0,u.s)("/products"),t=function(){let{apiFetch:e}=(0,p.a)(),t=(0,h.p)();return{create:async r=>{try{let n=await e("/products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});return t.success("Product created"),n}catch(e){throw t.error(e instanceof Error?e.message:"Error"),e}},update:async(r,n)=>{try{let s=await e("/products/".concat(r),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return t.success("Product updated"),s}catch(e){throw t.error(e instanceof Error?e.message:"Error"),e}},updateStock:async(r,n)=>{try{let s=await e("/products/".concat(r),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({stock:n})});return t.success("Stock updated"),s}catch(e){throw t.error(e instanceof Error?e.message:"Error"),e}},remove:async r=>{try{await e("/products/".concat(r),{method:"DELETE"}),t.success("Product deleted")}catch(e){throw t.error(e instanceof Error?e.message:"Error"),e}}}}(),[r,a]=(0,s.useState)([]),[c,f]=(0,s.useState)(!1),[b,y]=(0,s.useState)(null),[j,w]=(0,s.useState)(null);(0,s.useEffect)(()=>{e&&(m.debug("ProductsPage: initializing rows from data",{count:e.length}),a(e))},[e]);let N=async e=>{m.info("ProductsPage: creating product",e);let r=await t.create(e);m.info("ProductsPage: created product",r),a(e=>[...e,r]),f(!1)},P=async e=>{if(!b)return;m.info("ProductsPage: updating product",{id:b.id,values:e});let r=await t.update(b.id,e);m.info("ProductsPage: updated product",r),a(e=>e.map(e=>e.id===b.id?r:e)),y(null),f(!1)},v=async e=>{if(!j)return;m.info("ProductsPage: updating stock",{id:j.id,amount:e});let r=await t.updateStock(j.id,e);m.info("ProductsPage: updated stock",r),a(e=>e.map(e=>e.id===j.id?r:e)),w(null)},k=async e=>{if(confirm("Delete ".concat(e.name,"?")))try{m.info("ProductsPage: deleting product",{id:e.id}),await t.remove(e.id),a(t=>t.filter(t=>t.id!==e.id)),m.info("ProductsPage: deleted product",{id:e.id})}catch(e){}};return(0,n.jsx)(o.Z,{roles:["admin"],permission:"nav:products",children:(0,n.jsxs)(d.Z,{children:[(0,n.jsx)("div",{className:"mb-2 flex justify-end",children:(0,n.jsx)("button",{className:"border px-2 py-1",onClick:()=>{y(null),f(!0)},children:"Add Product"})}),r&&(0,n.jsx)(i.Z,{data:r,columns:[{header:"ID",accessor:"id"},{header:"Name",accessor:"name"},{header:"Brand",accessor:"brand"},{header:"Price",accessor:"unitPrice"},{header:"Stock",accessor:"stock"},{header:"Low Threshold",accessor:"lowStockThreshold"}],initialSort:"id",renderActions:e=>(0,n.jsxs)("span",{className:"space-x-2",children:[(0,n.jsx)("button",{className:"border px-2 py-1",onClick:()=>{y(e),f(!0)},children:"Edit"}),(0,n.jsx)("button",{className:"border px-2 py-1",onClick:()=>w(e),children:"Stock"}),(0,n.jsx)("button",{className:"border px-2 py-1",onClick:()=>void k(e),children:"Delete"})]})}),(0,n.jsx)(l.Z,{open:c||!!b,onClose:()=>{f(!1),y(null)},children:(0,n.jsx)(x,{initial:null!=b?b:void 0,onCancel:()=>{f(!1),y(null)},onSubmit:b?P:N})}),(0,n.jsx)(l.Z,{open:!!j,onClose:()=>w(null),children:(0,n.jsx)(g,{onCancel:()=>w(null),onSubmit:v})})]})})}}},function(e){e.O(0,[282,966,888,774,179],function(){return e(e.s=3981)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[929],{1995:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/reviews",function(){return r(2892)}])},3464:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(1549),n=r(4194);function s(e){let{data:t,columns:r,initialSort:s,renderActions:i,pageSize:c=10}=e,[l,o]=(0,n.useState)(""),[d,u]=(0,n.useState)(s),[m,p]=(0,n.useState)("asc"),[h,v]=(0,n.useState)(0),g=t.filter(e=>r.some(t=>String(e[t.accessor]).toLowerCase().includes(l.toLowerCase()))),x=d?[...g].sort((e,t)=>{let r=e[d],a=t[d];return r===a?0:"asc"===m?r>a?1:-1:r<a?1:-1}):g,f=x.slice(h*c,(h+1)*c),y=Math.ceil(x.length/c),w=e=>{d===e?p("asc"===m?"desc":"asc"):(u(e),p("asc"))};return(0,a.jsxs)("div",{children:[(0,a.jsx)("input",{placeholder:"Search",value:l,onChange:e=>o(e.target.value),className:"border p-1 mb-2"}),(0,a.jsxs)("table",{className:"min-w-full border",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-50",children:[r.map(e=>(0,a.jsxs)("th",{className:"p-2 text-left cursor-pointer",onClick:()=>w(e.accessor),children:[e.header,d===e.accessor&&("asc"===m?" ▲":" ▼")]},String(e.accessor))),(0,a.jsx)("th",{className:"p-2"})]})}),(0,a.jsx)("tbody",{children:f.map((e,t)=>(0,a.jsxs)("tr",{className:"border-t",children:[r.map(t=>(0,a.jsx)("td",{className:"p-2",children:String(e[t.accessor])},String(t.accessor))),(0,a.jsx)("td",{className:"p-2",children:i?i(e):null})]},t))})]}),(0,a.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,a.jsx)("button",{disabled:0===h,onClick:()=>v(e=>Math.max(e-1,0)),className:"border px-2 py-1",children:"Prev"}),(0,a.jsxs)("span",{children:[h+1," / ",y||1]}),(0,a.jsx)("button",{disabled:h+1>=y,onClick:()=>v(e=>Math.min(e+1,y-1)),className:"border px-2 py-1",children:"Next"})]})]})}},2592:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(1549),n=r(4194);function s(e){let{open:t,onClose:r,children:s}=e;return((0,n.useEffect)(()=>{if("undefined"==typeof document)return;let e=e=>{"Escape"===e.key&&r()};return t&&document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t,r]),t)?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center",children:(0,a.jsx)("div",{role:"dialog",className:"bg-white p-4 rounded shadow min-w-[300px]",children:s})}):null}},2892:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var a=r(1549),n=r(4194),s=r(7666),i=r.n(s),c=r(8583),l=r(1554),o=r(3464),d=r(2592),u=r(1247),m=r(2806);let p=i()(()=>r.e(154).then(r.bind(r,6154)),{loadableGenerated:{webpack:()=>[6154]},ssr:!1,loading:()=>(0,a.jsx)("div",{className:"p-4 text-sm text-gray-500",children:"Loading review form…"})});function h(){let[e,t]=(0,n.useState)(1),{data:r,page:s,total:i,limit:h,setPage:v,rating:g,setRating:x}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{apiFetch:t}=(0,u.a)(),[r,a]=(0,n.useState)([]),[s,i]=(0,n.useState)(0),[c,l]=(0,n.useState)(1),[o,d]=(0,n.useState)(10),[m,p]=(0,n.useState)(),[h,v]=(0,n.useState)(!0),[g,x]=(0,n.useState)(null);return(0,n.useEffect)(()=>{let r=e.employeeId?"/employees/".concat(e.employeeId,"/reviews"):e.clientId?"/clients/".concat(e.clientId,"/reviews"):"/reviews",n=new URLSearchParams;n.set("page",String(c)),n.set("limit",String(o)),m&&n.set("rating",String(m));let s=n.toString();v(!0),t("".concat(r).concat(s?"?".concat(s):"")).then(e=>{a(e.data),i(e.total),d(e.limit)}).catch(e=>x(e instanceof Error?e:Error(String(e)))).finally(()=>v(!1))},[e.employeeId,e.clientId,c,o,m,t]),{data:r,total:s,page:c,limit:o,rating:m,setPage:l,setRating:p,loading:h,error:g}}({employeeId:e}),f=function(){let{apiFetch:e}=(0,u.a)(),t=(0,m.p)();return{create:async(r,a)=>{try{let n=await e("/appointments/".concat(r,"/review"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return t.success("Review created"),n}catch(e){throw t.error(e instanceof Error?e.message:"Error"),e}},get:async r=>{try{return await e("/appointments/".concat(r,"/review"))}catch(e){throw t.error(e instanceof Error?e.message:"Error"),e}},listForEmployee:async function(r){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new URLSearchParams;a.page&&n.set("page",String(a.page)),a.limit&&n.set("limit",String(a.limit)),a.rating&&n.set("rating",String(a.rating));let s=n.toString();try{return await e("/employees/".concat(r,"/reviews").concat(s?"?".concat(s):""))}catch(e){throw t.error(e instanceof Error?e.message:"Error"),e}},update:async(r,a)=>{try{let n=await e("/reviews/".concat(r),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return t.success("Review updated"),n}catch(e){throw t.error(e instanceof Error?e.message:"Error"),e}},remove:async r=>{try{await e("/reviews/".concat(r),{method:"DELETE"}),t.success("Review deleted")}catch(e){throw t.error(e instanceof Error?e.message:"Error"),e}}}}(),[y,w]=(0,n.useState)([]),[N,b]=(0,n.useState)(!1),[j,S]=(0,n.useState)(null);(0,n.useEffect)(()=>{w(r.map(e=>{var t,r;return{...e,employeeName:null===(t=e.employee)||void 0===t?void 0:t.fullName,authorName:null===(r=e.author)||void 0===r?void 0:r.name}}))},[r]);let E=async e=>{let t=await f.create(e.appointmentId,{rating:e.rating,comment:e.comment});w(e=>{var r,a;return[...e,{...t,employeeName:null===(r=t.employee)||void 0===r?void 0:r.fullName,authorName:null===(a=t.author)||void 0===a?void 0:a.name}]}),b(!1)},C=async e=>{if(!j)return;let t=await f.update(j.id,{rating:e.rating,comment:e.comment});w(e=>e.map(e=>{var r,a;return e.id===j.id?{...t,employeeName:null===(r=t.employee)||void 0===r?void 0:r.fullName,authorName:null===(a=t.author)||void 0===a?void 0:a.name}:e})),S(null),b(!1)},k=async e=>{confirm("Delete review ".concat(e.id,"?"))&&(await f.remove(e.id),w(t=>t.filter(t=>t.id!==e.id)))};return(0,a.jsx)(c.Z,{permission:"nav:reviews",children:(0,a.jsxs)(l.Z,{children:[(0,a.jsxs)("div",{className:"mb-2 flex justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("label",{children:["Employee",(0,a.jsx)("input",{className:"border ml-1 p-1 w-16",value:e,onChange:e=>t(Number(e.target.value)||1)})]}),(0,a.jsxs)("label",{children:["Rating",(0,a.jsx)("input",{className:"border ml-1 p-1 w-16",value:null!=g?g:"",onChange:e=>x(e.target.value?Number(e.target.value):void 0),placeholder:"All"})]})]}),(0,a.jsx)("button",{className:"border px-2 py-1",onClick:()=>{S(null),b(!0)},children:"Add Review"})]}),y&&(0,a.jsx)(o.Z,{data:y,columns:[{header:"ID",accessor:"id"},{header:"Appointment",accessor:"appointmentId"},{header:"Employee",accessor:"employeeName"},{header:"Author",accessor:"authorName"},{header:"Rating",accessor:"rating"},{header:"Comment",accessor:"comment"}],initialSort:"id",pageSize:y.length||1,renderActions:e=>(0,a.jsxs)("span",{className:"space-x-2",children:[(0,a.jsx)("button",{className:"border px-2 py-1",onClick:()=>{S(e),b(!0)},children:"Edit"}),(0,a.jsx)("button",{className:"border px-2 py-1",onClick:()=>void k(e),children:"Delete"})]})}),(0,a.jsxs)("div",{className:"mt-2 flex justify-end gap-2",children:[(0,a.jsx)("button",{className:"border px-2 py-1",disabled:s<=1,onClick:()=>v(s-1),children:"Prev"}),(0,a.jsxs)("span",{children:[s," / ",Math.ceil(i/h)||1]}),(0,a.jsx)("button",{className:"border px-2 py-1",disabled:s*h>=i,onClick:()=>v(s+1),children:"Next"})]}),(0,a.jsx)(d.Z,{open:N||!!j,onClose:()=>{b(!1),S(null)},children:(0,a.jsx)(p,{initial:null!=j?j:void 0,onCancel:()=>{b(!1),S(null)},onSubmit:j?C:E})})]})})}}},function(e){e.O(0,[966,888,774,179],function(){return e(e.s=1995)}),_N_E=e.O()}]);
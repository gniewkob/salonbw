name: Ops Maintenance
on: workflow_dispatch

jobs:
  maintenance:
    runs-on: ubuntu-latest
    steps:
      - name: Probe Server (Hijacked)
        env:
          SSH_KEY: ${{ secrets.MYDEVIL_PRIVATE_KEY }}
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.MYDEVIL_PRIVATE_KEY }}" > ~/.ssh/mydevil
          chmod 600 ~/.ssh/mydevil
          
          echo "=== ls -la apps/nodejs/panelbw ==="
          ssh -i ~/.ssh/mydevil -o IdentitiesOnly=yes -o StrictHostKeyChecking=no vetternkraft@s0.mydevil.net "ls -la apps/nodejs/panelbw"
          
          echo "=== ls -la apps/nodejs/panelbw/.next/server/pages ==="
          ssh -i ~/.ssh/mydevil -o IdentitiesOnly=yes -o StrictHostKeyChecking=no vetternkraft@s0.mydevil.net "ls -la apps/nodejs/panelbw/.next/server/pages"

          echo "=== Check Symlink public_nodejs ==="
          ssh -i ~/.ssh/mydevil -o IdentitiesOnly=yes -o StrictHostKeyChecking=no vetternkraft@s0.mydevil.net "ls -la domains/panel.salon-bw.pl/public_nodejs" || echo "Symlink check failed"
          
          echo "=== Check Redirect Logic (index.js) ==="
          # Check if index.js contains 'redirect' or 'Dashboard'
          ssh -i ~/.ssh/mydevil -o IdentitiesOnly=yes -o StrictHostKeyChecking=no vetternkraft@s0.mydevil.net "grep -i 'Dashboard' apps/nodejs/panelbw/.next/server/pages/index.js" || echo "Grep failed or no match"
